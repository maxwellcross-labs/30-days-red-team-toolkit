"""
Base Enumerator Class
Abstract base for all trust enumeration methods
"""

from abc import ABC, abstractmethod
from typing import Optional, List
from ..models.trust import Trust, TrustCollection


class BaseEnumerator(ABC):
    """
    Abstract base class for trust enumerators
    All enumeration methods should inherit from this
    """

    def __init__(self, verbose: bool = True):
        """
        Initialize enumerator

        Args:
            verbose: Print status messages
        """
        self.verbose = verbose
        self.name = self.__class__.__name__

    def log(self, message: str, level: str = "info") -> None:
        """
        Print status message if verbose enabled

        Args:
            message: Message to print
            level: Log level (info, success, error, warning)
        """
        if not self.verbose:
            return

        prefixes = {
            "info": "[*]",
            "success": "[+]",
            "error": "[-]",
            "warning": "[!]",
        }
        prefix = prefixes.get(level, "[*]")
        print(f"{prefix} {message}")

    @abstractmethod
    def enumerate(
            self,
            domain: str,
            username: Optional[str] = None,
            password: Optional[str] = None,
            dc: Optional[str] = None
    ) -> List[Trust]:
        """
        Enumerate trust relationships

        Args:
            domain: Target domain
            username: Username for authentication
            password: Password for authentication
            dc: Domain controller IP/hostname

        Returns:
            List of Trust objects found
        """
        pass

    @abstractmethod
    def is_available(self) -> bool:
        """
        Check if this enumeration method is available

        Returns:
            True if method can be used
        """
        pass

    def enumerate_to_collection(
            self,
            collection: TrustCollection,
            domain: str,
            username: Optional[str] = None,
            password: Optional[str] = None,
            dc: Optional[str] = None
    ) -> int:
        """
        Enumerate trusts and add to existing collection

        Args:
            collection: TrustCollection to add results to
            domain: Target domain
            username: Username for authentication
            password: Password for authentication
            dc: Domain controller IP/hostname

        Returns:
            Number of new trusts added
        """
        trusts = self.enumerate(domain, username, password, dc)
        added = 0
        for trust in trusts:
            if collection.add(trust):
                added += 1
        return added