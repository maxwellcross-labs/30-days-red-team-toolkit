"""
Trust Type and Direction Converters
Utility functions for converting AD trust attributes to human-readable format
"""

# Trust Type Mappings (MS-ADTS 6.1.6.7.9)
TRUST_TYPES = {
    1: "Downlevel (Windows NT)",
    2: "Uplevel (Active Directory)",
    3: "MIT (Non-Windows Kerberos)",
    4: "DCE (Theoretical)",
}

# Trust Direction Mappings (MS-ADTS 6.1.6.7.9)
TRUST_DIRECTIONS = {
    0: "Disabled",
    1: "Inbound (This domain trusts the other domain)",
    2: "Outbound (The other domain trusts this domain)",
    3: "Bidirectional (Two-way trust)",
}

# Trust Attribute Flags (MS-ADTS 6.1.6.7.9)
TRUST_ATTRIBUTES = {
    0x00000001: "TRUST_ATTRIBUTE_NON_TRANSITIVE",
    0x00000002: "TRUST_ATTRIBUTE_UPLEVEL_ONLY",
    0x00000004: "TRUST_ATTRIBUTE_QUARANTINED_DOMAIN (SID Filtering)",
    0x00000008: "TRUST_ATTRIBUTE_FOREST_TRANSITIVE",
    0x00000010: "TRUST_ATTRIBUTE_CROSS_ORGANIZATION",
    0x00000020: "TRUST_ATTRIBUTE_WITHIN_FOREST",
    0x00000040: "TRUST_ATTRIBUTE_TREAT_AS_EXTERNAL",
    0x00000080: "TRUST_ATTRIBUTE_USES_RC4_ENCRYPTION",
    0x00000200: "TRUST_ATTRIBUTE_CROSS_ORGANIZATION_NO_TGT_DELEGATION",
    0x00000400: "TRUST_ATTRIBUTE_PIM_TRUST",
}


def get_trust_type(trust_type_value: int) -> str:
    """
    Convert trust type integer to readable format

    Args:
        trust_type_value: Integer trust type from AD

    Returns:
        Human-readable trust type string
    """
    return TRUST_TYPES.get(trust_type_value, f"Unknown ({trust_type_value})")


def get_trust_direction(direction_value: int) -> str:
    """
    Convert trust direction integer to readable format

    Args:
        direction_value: Integer direction from AD

    Returns:
        Human-readable direction string
    """
    return TRUST_DIRECTIONS.get(direction_value, f"Unknown ({direction_value})")


def get_direction_symbol(direction: str) -> str:
    """
    Get arrow symbol for trust direction visualization

    Args:
        direction: Direction string

    Returns:
        Arrow symbol for visual representation
    """
    if "Bidirectional" in direction:
        return "<-->"
    elif "Inbound" in direction:
        return "<--"
    elif "Outbound" in direction:
        return "-->"
    else:
        return "---"


def is_sid_filtering_enabled(trust_attributes: int) -> bool:
    """
    Check if SID filtering (quarantine) is enabled

    Args:
        trust_attributes: Trust attributes bitmask

    Returns:
        True if SID filtering is enabled
    """
    return bool(trust_attributes & 0x00000004)


def is_forest_transitive(trust_attributes: int) -> bool:
    """
    Check if trust is forest transitive

    Args:
        trust_attributes: Trust attributes bitmask

    Returns:
        True if forest transitive
    """
    return bool(trust_attributes & 0x00000008)


def is_within_forest(trust_attributes: int) -> bool:
    """
    Check if trust is within same forest

    Args:
        trust_attributes: Trust attributes bitmask

    Returns:
        True if within forest
    """
    return bool(trust_attributes & 0x00000020)


def parse_trust_attributes(trust_attributes: int) -> list:
    """
    Parse trust attributes bitmask into list of flags

    Args:
        trust_attributes: Trust attributes bitmask

    Returns:
        List of enabled attribute names
    """
    enabled = []
    for flag, name in TRUST_ATTRIBUTES.items():
        if trust_attributes & flag:
            enabled.append(name)
    return enabled